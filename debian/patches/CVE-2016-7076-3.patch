
# HG changeset patch
# User Todd C. Miller <Todd.Miller@courtesan.com>
# Date 1476110330 21600
# Node ID 167a518d81293e6abc6e40070d442dabcb919c0d
# Parent  7b8357b0a3583f7d99cdb22a209cdf2f1ee8d775
Need RTLD_NEXT for wordexp() on dlopen() systems.  It is missing on AIX 5.1 at least.

diff -r 7b8357b0a358 -r 167a518d8129 src/sudo_noexec.c
--- a/src/sudo_noexec.c	Mon Oct 10 08:33:57 2016 -0600
+++ b/src/sudo_noexec.c	Mon Oct 10 08:38:50 2016 -0600
@@ -164,7 +164,7 @@
 }
 INTERPOSE(popen)
 
-#ifdef HAVE_WORDEXP
+#if defined(HAVE_WORDEXP) && (defined(RTLD_NEXT) || defined(HAVE_SHL_LOAD) || defined(HAVE___INTERPOSE))
 /*
  * We can't use a wrapper for wordexp(3) since we still want to call
  * the real wordexp(3) but with WRDE_NOCMD added to the flags argument.
@@ -212,7 +212,7 @@
 #endif /* HAVE___INTERPOSE */
 }
 INTERPOSE(wordexp)
-#endif /* HAVE_WORDEXP */
+#endif /* HAVE_WORDEXP && (RTLD_NEXT || HAVE_SHL_LOAD || HAVE___INTERPOSE) */
 
 /*
  * On Linux we can use a seccomp() filter to disable exec.

