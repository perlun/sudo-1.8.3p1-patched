
# HG changeset patch
# User Todd C. Miller <Todd.Miller@courtesan.com>
# Date 1479078031 25200
# Node ID 120a317ce25bc9ddfe850d553528eeaf880770f7
# Parent  b4f51b79bd9eeada1d9488f070aab986a6277689
Need to link sudo_noexec.so with -ldl for dlsym() on some platforms.
Otherwise, the wordexp(3) wrapper will fail due to an undefined
symbol.  Bug #761

Index: sudo-1.8.16/src/Makefile.in
===================================================================
--- sudo-1.8.16.orig/src/Makefile.in	2019-05-01 11:30:25.919029455 -0400
+++ sudo-1.8.16/src/Makefile.in	2019-05-01 11:30:25.915029446 -0400
@@ -142,7 +142,7 @@ sudo: $(OBJS) $(LT_LIBS) @STATIC_SUDOERS
 	$(LIBTOOL) $(LTFLAGS) --mode=link $(CC) -o $@ $(OBJS) $(SUDO_LDFLAGS) $(PIE_LDFLAGS) $(SSP_LDFLAGS) $(LIBS) @STATIC_SUDOERS@
 
 sudo_noexec.la: sudo_noexec.lo
-	$(LIBTOOL) $(LTFLAGS) --mode=link $(CC) $(LDFLAGS) $(LT_LDFLAGS) $(SSP_LDFLAGS) -o $@ sudo_noexec.lo -module -avoid-version -rpath $(noexecdir) -shrext .so
+	$(LIBTOOL) $(LTFLAGS) --mode=link $(CC) $(LDFLAGS) $(LT_LDFLAGS) $(SSP_LDFLAGS) @LIBDL@ -o $@ sudo_noexec.lo -module -avoid-version -rpath $(noexecdir) -shrext .so
 
 sesh: $(SESH_OBJS) $(LT_LIBS)
 	$(LIBTOOL) $(LTFLAGS) --mode=link $(CC) -o $@ $(SESH_OBJS) $(LDFLAGS) $(PIE_LDFLAGS) $(SSP_LDFLAGS) $(LIBS)
